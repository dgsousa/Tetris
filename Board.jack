class Board {
    field char isOne;
    field Array allSquares;

    constructor Board new() {
        let isOne = 49;
        do initializeBoard();
        return this;
    }

    method void initializeBoard() {
        var int counter;
        var Array newRow;
        let counter = 0;
        let allSquares = Array.new(16);
        while(counter < 16) {
            let allSquares[counter] = "00000000000000000000000000000000";
            let counter = counter + 1;
        }
        return;
    }

    method void addShapeToBoard(String shapeMap, int newX, int newY) {
        var int row, column;
        var char bitChar;
        while(row < 4) {
            while(column < 4) {
                let bitChar = shapeMap.charAt(((row * 4) + column));
                if(bitChar = isOne) {
                    do updateBoardSquare((newX + column), (newY + row));
                }
                let column = column + 1;
            }
            let column = 0;
            let row = row + 1;
        }
        return;
    }

    method void updateBoardSquare(int xPos, int yPos) {
        var String currentRow;
        var char one;
        let one = 49;
        let currentRow = allSquares[yPos];
        do currentRow.setCharAt(xPos, one);
        let allSquares[yPos] = currentRow;
        do Drawer.drawBox(xPos, yPos, -1);
        return;
    }

    method Boolean isInContactAbove(String shapeMap, int newX, int newY) {
        var int row, column;
        var String boardRow;
        var char bitChar, boardChar;
        while(row < 4) {
            while(column < 4) {
                let bitChar = shapeMap.charAt(((row * 4) + column));
                if(bitChar = isOne) {
                    if((row + newY) < 15) {
                        let boardRow = allSquares[(newY + row + 1)];
                        let boardChar = boardRow.charAt(newX + column);
                        if(boardChar = isOne) {
                            return true;
                        }
                    }
                }
                let column = column + 1;
            }
            let column = 0;
            let row = row + 1;
        }
        return false;
    }

    method Boolean wouldOverlap(String shapeMap, int newX, int newY) {
        var int row, column;
        var String boardRow;
        var char bitChar, boardChar;
        while(row < 4) {
            while(column < 4) {
                let bitChar = shapeMap.charAt(((row * 4) + column));
                if(bitChar = isOne) {
                    let boardRow = allSquares[(newY + row)];
                    let boardChar = boardRow.charAt(newX + column);
                    if(boardChar = isOne) {
                        return true;
                    }
                }
                let column = column + 1;
            }
            let column = 0;
            let row = row + 1;
        }
        return false;
    }

    method Boolean shapeIsInBounds(String shapeMap, int newX, int newY) {
        var int row, column;
        var char bitChar, boardChar;
        while(row < 4) {
            while(column < 4) {
                let bitChar = shapeMap.charAt(((row * 4) + column));
                if(bitChar = isOne) {
                    if(~(isInBounds((column + newX), (row + newY)))) {
                        return false;
                    }
                }
                let column = column + 1;
            }
            let column = 0;
            let row = row + 1;
        }
        return true;
    }

    method Boolean isInBounds(int x, int y) {
        return ((~(x < 0)) & (~(x > 31)) & (~(y < 0)) & (~(y > 14)));
    }

    method Boolean canRotate(String shapeMap, Array position) {
        var int xPos, yPos, row, column;
        var String boardRow;
        var char bitChar, boardChar;
        let xPos = position[0];
        let yPos = position[1];
        while(row < 4) {
            while(column < 4) {
                let bitChar = shapeMap.charAt(((row * 4) + column));
                if(bitChar = isOne) {
                    let boardRow = allSquares[(yPos + row)];
                    let boardChar = boardRow.charAt(xPos + column);
                    if((~isInBounds((xPos + column), (yPos + row))) | boardChar = isOne) {
                        return false;
                    }
                }
                let column = column + 1;
            }
            let column = 0;
            let row = row + 1;
        }
        return true;
    }

    method Boolean shapeIsAtFloor(String shapeMap, int newX, int newY) {
        var int row, column;
        var char bitChar, boardChar;
        while(row < 4) {
            while(column < 4) {
                let bitChar = shapeMap.charAt(((row * 4) + column));
                if(bitChar = isOne) {
                    if((newY + row) = 15) {
                        return true;
                    }
                }
                let column = column + 1;
            }
            let column = 0;
            let row = row + 1;
        }
        return false;
    }
}